# Reference

# WebSocket API - MARKET API

## Candlestick Data

**market.$symbol$.kline.$period$**

 key         | necessary  | type     | description   | value
 --- | ---  | --- | --- | ---
 symbol | true  | string | Pairs | ethbtc, ltcbtc, etcbtc, bccbtc... The new symbols below will be available on and from the effective date, huobi10 and hb10
 period | true | string | KLine period | 1min, 5min, 15min, 30min, 60min, 1day, 1mon, 1week, 1year


request
```json
{
  "sub": "market.symbol.kline.period",
  "id": "id generate by client"
}
```


request
```json
{
  "sub": "market.ethbtc.kline.1min",
  "id": "id1"
}
```

response
```json
{
  "id": "id1",
  "status": "ok",
  "subbed": "market.ethbtc.kline.1min",
  "ts": 1489474081631
}
```

After subscribe,you will receive updates upon any change.


```json
{
  "ch": "market.ethbtc.kline.1min",
  "ts": 1489474082831,
  "tick": {
    "id": 1489464480,
    "amount": 0.0,
    "count": 0,
    "open": 7962.62,
    "close": 7962.62,
    "low": 7962.62,
    "high": 7962.62,
    "vol": 0.0
  }
}
```

## Request KLine

### market.$symbol$.kline.$period$  

#### The new symbols are huobi10 and hb10

* Request Parameter(s)

Symbol| Description
--|--
huobi10| Index
hb10 | ETF net asset value.

Other request parameters (period, from, to) will remain the same.

* Response

The response structure will remain the same, where the amount, count and vol will always be 0 for huobi10 and hb10, since the amount,    count and vol in the response refer to the amount, count and vol of TRADE, while index and etf net asset value would not have such data. The updates will be sent every 15 seconds upon the changes for both huobi10 and hb10 as long as the API connection is live.  


request
```json
{
  "req": "market.$symbol.kline.$period",
  "id": "id generated by client",
  "from": "$optional",
  "to": "$optional"
}
```

`"from"` `"to"` optional

time range:[t2,t5]

* from: t1, to: t5, return [t1, t5].
* from: t5, to: t1, which t5 > t1, return [].
* from: t5, return [t5].
* from: t3, return [t3, t5].
* to: t5, return [t1, t5].
* from: t which t3 < t <t4, return [t4, t5].
* to: t which t3 < t <t4, return [t1, t3].
* from: t1 and to: t2, should satisfy 1325347200 < t1 < t2 < 2524579200.

#### example

request
```json
{
  "req": "market.ethbtc.kline.1min",
  "id": "id10"
}
```

response
```json
{
  "rep": "market.ethbtc.kline.1min",
  "status": "ok",
  "id": "id10",
  "tick": [
    {
      "amount": 17.4805,
      "count":  27,
      "id":     1494478080,
      "open":   10050.00,
      "close":  10058.00,
      "low":    10050.00,
      "high":   10058.00,
      "vol":    175798.757708
    },
    {
      "amount": 15.7389,
      "count":  28,
      "id":     1494478140,
      "open":   10058.00,
      "close":  10060.00,
      "low":    10056.00,
      "high":   10065.00,
      "vol":    158331.348600
    },
  ]
}
```

## Subscribe Market Depth

market.$symbol$.depth.$type$


```json
{
  "sub": "market.$symbol.depth.$type",
  "id": "id generated by client"
}
```
 key | necessary| type | description | value
 --- | --- | --- | --- | ---
 symbol | true  | string | Pairs | ethbtc, ltcbtc, etcbtc, bccbtc...
 type | true| string | Market depth | step0, step1, step2, step3, step4, step5

**example**

request
```json
{
  "sub": "market.ethbtc.depth.step0",
  "id": "id1"
}
```

response
```json
{
  "id": "id1",
  "status": "ok",
  "subbed": "market.ethbtc.depth.step0",
  "ts": 1489474081631
}
```

After subscribe,you will receive updates upon any change.


```json
{
  "ch": "market.ethbtc.depth.step0",
  "ts": 1489474082831,
  "data": {
    "bids": [
        [9999.3900,0.0098],
        [9992.5947,0.0560],
    ],
    "asks": [
        [10010.9800,0.0099]
        [10011.3900,2.0000]
    ]
}
  }
}
```

`data` description

```json
"data": {
    "bids": [
        ["price","volume"],
        ["price","volume"]
    ],
    "asks": [
        ["price","volume"],
        ["price","volume"]
    ]
}
```

## Request Market Depth

market.$symbol$.depth.$type$

```json
{
  "req": "market.$symbol.depth.$type",
  "id": "id generated by client"
}
```

**example**

request
```json
{
  "req": "market.ethbtc.depth.step0",
  "id": "id10"
}
```

response
```json
{
    "rep": "market.ethbtc.depth.step0",
    "status": "ok",
    "id": "id10",
    "data": {
        "bids": [
            [9999.3900,0.0098],
            [9992.5947,0.0560],
        ],
        "asks": [
            [10010.9800,0.0099]
            [10011.3900,2.0000]
        ]
    }
}
```

## Subscribe Trade Detail

 market.$symbol$.trade.detail  

request
```json
{
  "sub": "market.ethbtc.trade.detail",
  "id": "id1"
}
```

response
```json
{
  "id": "id1",
  "status": "ok",
  "subbed": "market.ethbtc.trade.detail",
  "ts": 1489474081631
}
```

After subscribe,you will receive updates upon any change.


```json
{
  "ch": "market.ethbtc.trade.detail",
  "ts": 1489474082831,
  "data": [
            {
                "amount": 0.0099,
                "ts": 1533265950234,
                "id": 146507451359183894799,
                "price": 401.74,
                "direction": "buy"
            },
        ]
}
```


## Request Trade Detail

 market.$symbol$.trade.detail

request
```json
{
  "req": "market.$symbol.trade.detail",
  "id": "id generated by client"
}
```

Max data amount: 300

**example**

request
```json
{
  "req": "market.ethbtc.trade.detail",
  "id": "id11"
}
```

response
```json
{
  "rep": "market.ethbtc.trade.detail",
  "status": "ok",
  "id": "id11",
  "data": [
    {
      "id":        601595424,
      "price":     10195.64,
      "time":      1494495766,
      "amount":    0.2943,
      "direction": "buy",
      "tradeId":   601595424,
      "ts":        1494495766000
    },
    {
      "id":        601595423,
      "price":     10195.64,
      "time":      1494495711,
      "amount":    0.2430,
      "direction": "buy",
      "tradeId":   601595423,
      "ts":        1494495711000
    },
  ]
}
```

## Request Market Detail

 market.$symbol$.detail

request
```json
{
  "req": "market.$symbol.detail",
  "id": "id generated by client"
}
```

Response recent Market Detail

**example**

request
```json
{
  "req": "market.ethbtc.detail",
  "id": "id12"
}
```

response
```json
{
  "rep": "market.ethbtc.detail",
  "status": "ok",
  "id": "id12",
  "tick": {
    "amount": 12224.2922,
    "open":   9790.52,
    "close":  10195.00,
    "high":   10300.00,
    "ts":     1494496390000,
    "id":     1494496390,
    "count":  15195,
    "low":    9657.00,
    "vol":    121906001.754751
  }
}
```

# WebSocket API - TRADE API (BETA)
# =========================
## Subscribe accounts
Subscribe accounts changes update


```json
{
      "op": "sub",
      "cid": "40sG903yz80oDFWr",
      "topic": "accounts"

    }
```
Successfully subscribed data example

```json
{
      "op": "sub",
      "cid": "40sG903yz80oDFWr",
      "err-code": 0,
      "ts": 1489474081631,
      "topic": "accounts"
    }
```
Whenever user account is changed, Client will received a notification.
For example,

```json
{
      "op": "notify",
      "ts": 1522856623232,
      "topic": "accounts",
      "data": {
        "event": "order.match|order.place|order.refund|order.cancel|order.fee-refund|margin.transfer|margin.loan|margin.interest|margin.repay|other",
        "list": [
          {
            "account-id": 419013,
            "currency": "usdt",
            "type": "trade",
            "balance": "500009195917.4362872650"
          },
          {
            "account-id": 419013,      
            "currency": "btc",
            "type": "frozen",
            "balance": "9786.6783000000"
          }
        ]
      }
    }
```
The format of notification whenever the accounts changed.

name         |type     |description
------------ |-------- |----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
event        |string|   the event that Asset Change Notification Related ,for example : create order (order.place) , commit order (order.match),order refunds（order.refund),order canceled (order.cancel) ,card deducts transaction fee （order.fee-refund),lever account transfer（margin.transfer),loan principal（margin.loan),loan interest （margin.interest),return loan interest(margin.repay),other asset change(other)
account-id   |long     |account's id
currency     |string   |currency's type
type         |string   |account's type, trading available accounts(trade),trading frozen accounts(frozen)
balance      |string   |account's balance

## Sub orders.$symbol
To subscribe order changes update


```json
{
      "op": "sub",
      "cid": "40sG903yz80oDFWr",
      "topic": "orders.htusdt"
    }
```
Successfully subscribed data example

```json
{
      "op": "sub",
      "cid": "40sG903yz80oDFWr",
      "err-code": 0,
      "ts": 1489474081631,
      "topic": "orders.htusdt"
    }
```
when any order updates, user will receive message like below,

```json
{
      "op": "notify",
      "topic": "orders.htusdt",
      "ts": 1522856623232,
      "data": {
        "seq-id": 94984,
        "order-id": 2039498445,
        "symbol": "htusdt",
        "account-id": 100077,
        "order-amount": "5000.000000000000000000",
        "order-price": "1.662100000000000000",
        "created-at": 1522858623622,
        "order-type": "buy-limit",
        "order-source": "api",
        "order-state": "filled",
        "role": "taker|maker",
        "price": "1.662100000000000000",
        "filled-amount": "5000.000000000000000000",
        "unfilled-amount": "0.000000000000000000",
        "filled-cash-amount": "8301.357280000000000000",
        "filled-fees": "8.000000000000000000"
      }
    }
```
Order change notification format

name                 |type     |description
-------------------- |-------- |--------------------------------------------------------------------------------
seq-id               |long     |serial number(discontinuity )
order-id             |long     |order's id
symbol               |string   |trade's couple
account-id           |long     |order's id
order-amount         |string   |order's amount
order-price          |string   |order's price
created-at           |long     |timestamp of order created
order-type           |string   |please refer to order type description in Appendix section
order-source         |string   |please refer to order source description in Appendix section
order-state          |string   |please refer to order state description in Appendix section
role                 |string   |maker, taker
price                |string   |transaction price
filled-amount        |string   |filled amount this time
unfilled-amount      |string   |unfilled amount this time
filled-cash-amount   |string   |filled cash amount this time
filled-fees          |string   |filled fees this time（buying is used by currency ,selling is used by money ）

## Cancel subscription (unsub)
-------------------------------
After successfully establishing a connection with the WebSocket API,
send the data in the following format to the Server to cancel
subscribing data:

Cancel subscription

```json
{
    "op": "unsub",
    "topic": "topic to unsub",
  "cid": "id generated by client",
}
```
The format of cancel subscription

name    |type     |instruction
------- |-------- |-------------------------------------------------------------------------------------
op      |string   |required; the type of requested operator is unsub;
cid     |string   |optional; the id of Client request
topic   |string   |required; the name of subscribe's topic cancel the list of topic is in the appendix;

The example of canceled subscribe data
Correct unsubscribe request

```json
{
      "op": "unsub",
      "topic": "accounts",
      "cid": "40sG903yz80oDFWr"
    }
```
Unsubscribe successfully returns data example

```json
{
      "op": "unsub",
      "topic": "accounts",
      "cid": "id generated by client",
      "err-code": 0,
      "ts": 1489474081631
    }
```
### Subscribing and Unsubscribing Rule Description
----------------------------------------------

Subscription(sub)   |Unsubscribe(unsub)  | Rule
------------------- |-------------------- |-----------
accounts            |accounts             |allow
orders.\*           |orders.\*            |allow
orders.symbol1      |orders.\*            |allow
orders.symbol1      |orders.symbol1       |allow
orders.symbol1      |orders.symbol2       |not allow
orders.\*           |orders.symbol1       |not allow

## Request accounts.list
Query all account data of the current user

After successfully establishing a connection with the WebSocket API,
send the data in the following format to the Server to query the account data:

Account query request data format

name    |type     |instruction
------- |-------- |----------------------------------------------------------------------------------------
op      |string   |required; Operation name, fixed value is 'req';
cid     |string   |optional; Client's ID
topic   |string   |required; Please refer to topic description in the Appendix section;

Request accounts.list example
Request

```json
{
      "op": "req",
      "topic": "accounts.list",
      "cid": "40sG903yz80oDFWr"
    }
```
The successful request returns data

```json
{
    "op": "req",
    "topic": "accounts.list",
    "cid": "40sG903yz80oDFWr",
    "err-code": 0,
    "ts": 1489474082831,
    "data": [
        {
            "id": 419013,
            "type": "spot",
            "state": "working",
            "list": [
                {
                    "currency": "usdt",
                    "type": "trade",
                    "balance": "500009195917.4362872650"
                },
                { "currency": "usdt","type": "frozen","balance": "9786.6783000000" }
            ]
        },
        {
            "id": 35535,
            "type": "point",
            "state": "working",
            "list": [
                { "currency": "eth","type": "trade","balance": "499999894616.1302471000" },
                { "currency": "eth","type": "frozen","balance": "9786.6783000000" }
            ]
        }
    ]
}
```


Call failure response data exampleerr-code: Response codes, 0  represent success;others value  is error,the list of Response codes is in appendix
```json
{
      "op": "req",
      "topic": "foo.bar",
      "cid": "40sG903yz80oDFWr",
      "err-code": 12001,
      "err-msg": "detail of error message",
      "ts": 1489474081631
}
```
## Request orders.list
Query the open and historical orders.

Request orders.list data format

name         |required   |type    | description                                                                                   
------------ |---------- |-------- |---------------------------------------------------------------------------------------------
op           |true       |string   |Operation name, fixed value is req  
cid          |false      |string   |Client's ID      
topic        |true       |string   |The fixed value is orders.list. Please refer to the appendix for a detailed list of topics.   
account-id   |true       |long     |account's id  
symbol       |true       |string   |trading symbols                                                                                 btcusdt, ltcbtc, etcbtc, htusdt......
types        |false      |string   |Query order type combination, use ',' to separate each type.
start-date   |false      |string   |Query starting date, date format is yyyy-mm-dd   
end-date     |false      |string  | Query ending date, date format is yyyy-mm-dd   
states       |true       |string   |Query order state combination, use ',' to separate each order state.
from         |false      |string   |querying start ID
direct       |false      |string   |querying direct                                                                                       prev forward, next backward
size         |false      |string   |Query record size

Order list query request example

Request

```json
{
      "op": "req",
      "topic": "orders.list",
      "cid": "40sG903yz80oDFWr",
      "symbol": "htusdt",
      "states": "submitted,partial-filled"
}
```
The successful request returns data

```json
{
  "op": "req",
  "topic": "orders.list",
  "cid": "40sG903yz80oDFWr",
  "err-code": 0,
  "ts": 1522856623232,
  "data": [
    {
      "id": 2039498445,
      "symbol": "htusdt",
      "account-id": 100077,
      "amount": "5000.000000000000000000",
      "price": "1.662100000000000000",
      "created-at": 1522858623622,
      "type": "buy-limit",
      "filled-amount": "5000.000000000000000000",
      "filled-cash-amount": "8301.357280000000000000",
      "filled-fees": "8.000000000000000000",
      "finished-at": 1522858624796,
      "source": "api",
      "state": "filled",
      "canceled-at": 0
    }
  ]
}
```
Response data format description,

name                 |type     |instruction
-------------------- |-------- |-------------------------------------------------------------------------
id                   |long     |order's ID
symbol               |string   |trading couple
account-id           |long     |account's ID
amount               |string   |order amount
price                |string   |order price
created-at           |long     |order creation time
type                 |string   |order type, refer to the order type description in the Appendix section
filled-amount        |string   |trade amount
filled-cash-amount   |string   |trade value
filled-fees          |string   |trade fee
finished-at          |string   |Last transaction time
source               |string   |order source ,refer to the order source description in the Appendix section
state                |string   |order state, refer to the order state description in the Appendix section
cancel-at            |long     |canceled time

## Request orders.detail
Query the order details.

Order details query request data format description

name       |required   |type     |description  
---------- |---------- |-------- |---------------------------------------------------------------------------------------------
op         |true       |string   |Operation name, fixed value is req     
cid        |false      |string   |Client's ID  
topic      |true       |string   |The fixed value is orders.list. Please refer to the appendix for a detailed list of topics.
order-id   |true       |string   |order's id

Order details query request example

Request

```json
{
      "op": "req",
      "topic": "orders.detail",
      "order-id": "2039498445",
      "cid": "40sG903yz80oDFWr"
    }
```
The Successful request returned data example

```json
{
      "op": "req",
      "topic": "orders.detail",
      "cid": "40sG903yz80oDFWr",
      "err-code": 0,
      "ts": 1522856623232,
      "data": {
        "id": 2039498445,
        "symbol": "htusdt",
        "account-id": 100077,
        "amount": "5000.000000000000000000",
        "price": "1.662100000000000000",
        "created-at": 1522858623622,
        "type": "buy-limit",
        "filled-amount": "5000.000000000000000000",
        "filled-cash-amount": "8301.357280000000000000",
        "filled-fees": "8.000000000000000000",
        "finished-at": 1522858624796,
        "source": "api",
        "state": "filled",
        "canceled-at": 0
      }
    }
```
** Request data (req) request limiting strategy
============================================

In order to encourage users to use the subscription to receive data
push, a restriction strategy is made on the query request， The Rule
is：

-   accounts.list The query request ,the same user (No matter how many
    connections)，the interval of twice query request can not be less
    than 25 sec (This number may change), otherwise client will receive
    a error response that is "too many request".
-   orders.list AND orders.detail The query request,the same user (No
    matter how many connections)，the interval of twice query request
    can not be less than 5 sec (This number may change), otherwise
    client will receive a error response that is "too many request"

##Appendix
--------

### Operator type（OP ）

type     |description
-------- |-----------------------------------
ping     |send heartbeat (server)
pong     |return heartbeat
auth     |Authentication
sub      |subscript message
unsub    |cancel Subscription message
req      |request data
notify   |push subscription message(server)

### Topic type Description

 type | applicative operator type | description
------------|------|------------
 accounts | sub, unsub | Subscribe, unsubscribe from all asset change messages
orders.$symbol | sub, unsub | Subscribing to or unsubscribing to an order change message for a trading partner. When the $symbol value is `*`, it means to subscribe to all trading couples.
accounts.list | req | Account data request
 orders.list | req | Order list query request
 orders.detail | req | Order details query request

### Response code（Err-Code）

> The specific code table please reference to `error.json`

### Order Type Description

type          |description
------------- |----------------------------------------
buy-market    |market price buy
sell-market   |market price sell
buy-limit     |limit price buy
sell-limit    |limit price sell
buy-ioc      | buy immediate execution or cancel
sell-ioc      |Sell immediate execution or cancel
buy-limit-maker| buy side, limit maker order
sell-limit-maker|sell side, limit maker order

### Order State Description

type               |description
------------------ |----------------------------------------
submitted          |submitted
partial-filled     |partial filled
partial-canceled   |cancel partial filled (terminal state)
filled             |completely filled(terminal state)
canceled           |order cancels (terminal state)

### Order Source Description

type         |description
------------ |----------------------------
spot-web     |Spot Web Trading
spot-api     |Spot Api Trading
spot-app     |Spot App Trading
margin-web   |Margin Web Trading
margin-api   |Margin Api Trading
margin-app   |Margin App Trading
fl-sys       |Margin Force Level Trading
